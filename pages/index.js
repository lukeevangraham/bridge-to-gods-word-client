import Head from "next/head";
import qs from "qs";
import Image from "next/image";
import Link from "next/link";
import Layout from "../hoc/Layout/Layout";
import Sections from "../components/Sections/Sections";
import { fetchAPI } from "../lib/api";

// import styles from "../styles/Home.module.css";
import classes from "./index.module.scss";

export async function getStaticProps() {
  const [globalData, homeData, latestBlog] = await Promise.all([
    fetchAPI("/global?populate=*,navbar.links,navbar.Button"),
    fetchAPI(`/home?populate=deep`),
    fetchAPI(
      `/blogs?sort=DatePosted:desc&pagination[pageSize]=1&populate[0]=blog_topics`
    ),
  ]);

  return {
    props: {
      globalData: globalData.data.attributes,
      homeData,
      latestBlog: latestBlog.data[0].attributes,
    },
    revalidate: 1,
  };
}

export default function Home({ globalData, homeData, latestBlog }) {
  return (
    <Layout global={globalData}>
      {console.log("Latest Blog: ", latestBlog)}
      <div>
        <Head>
          <title>Carla Unseth - A Bridge To God&apos;s Word</title>
          <meta name="description" content="Generated by create next app" />
          <link rel="icon" href="/favicon.ico" />
        </Head>

        <main className={classes.main}>
          {/* <h1>{homeData.data.attributes.testText}</h1> */}
          <header className={classes.header}>
            <div className={classes.topImage}>
              <Image
                src={homeData.data.attributes.testCover.data.attributes.url}
                layout="fill"
                objectFit="cover"
                priority
              />
            </div>
            <h1>{homeData.data.attributes.testText}</h1>
          </header>

          <section className={`${classes.mission} u-padding-y-medium`}>
            <div className="row">
              <div className={classes.mission__Statement}>
                {homeData.data.attributes.MissionStatement}
              </div>
              <div className={classes.mission__Explanation}>
                {homeData.data.attributes.MissionExplanation}
              </div>
            </div>
          </section>

          <section className={classes.about}>
            <div className="row">
              <div className={classes.personal}>
                <div className={classes.aboutPhoto}>
                  <Image
                    src={
                      homeData.data.attributes.aboutPhoto.data.attributes.url
                    }
                    layout="fill"
                    objectFit="cover"
                  />
                </div>
                <div
                  className={classes.text}
                  dangerouslySetInnerHTML={{
                    __html: homeData.data.attributes.aboutText,
                  }}
                ></div>
              </div>
            </div>
          </section>

          <section className={classes.latestBlog}>
            <div className="row">
              <h2>Latest Blog</h2>
              <div className={classes.latestBlog__DateBox}>
                <div>
                  {new Date(
                    latestBlog.DatePosted.replace(/-/g, "/")
                  ).toLocaleDateString("en-US", { day: "numeric" })}
                </div>
                <div>
                  {new Date(
                    latestBlog.DatePosted.replace(/-/g, "/")
                  ).toLocaleDateString("en-US", { month: "short" })}
                </div>
              </div>
              <Link href={`/blog/${latestBlog.slug}`}>
                <a>
                  <h3>{latestBlog.Title}</h3>
                </a>
              </Link>
              <div>
                {latestBlog.Body.replace(/<br>/g, " ")
                  .replace(/<[^>]+>/g, "")
                  .split(" ")
                  .splice(0, 32)
                  .join(" ")}
                ...
              </div>
              <div>
                {latestBlog.blog_topics.data.map((topic) => (
                  <div>{topic.attributes.Topic}</div>
                ))}
              </div>
              <h4>
                <Link href="/blog">See other blog posts</Link>
              </h4>
            </div>
          </section>

          <Sections sections={homeData.data.attributes.contentSections} />
        </main>

        <footer>
          {/* <a
            href="https://vercel.com?utm_source=create-next-app&utm_medium=default-template&utm_campaign=create-next-app"
            target="_blank"
            rel="noopener noreferrer"
          >
            Powered by{" "}
            <span>
              <Image
                src="/vercel.svg"
                alt="Vercel Logo"
                width={72}
                height={16}
              />
            </span>
          </a> */}
        </footer>
      </div>
    </Layout>
  );
}
